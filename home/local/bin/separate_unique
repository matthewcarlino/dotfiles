#!/bin/bash

PRISTINE=/mnt/hd/thevgroot/FILE_MAN/PRISTINE
DUPLICATES=/mnt/hd/thevgroot/FILE_MAN/DUPLICATES
EMPTIES=/mnt/hd/thevgroot/EMPTIES

mkdir -p $PRISTINE 
mkdir -p $DUPLICATES
mkdir -p $EMPTIES

pristine()
{
    f="$1"

    if [ -f "$f" ] && [[ ! $f = $PRISTINE/* ]]
    then
        printf "\tMoving $f to PRISTINE\n"
        echo "dry run: mv $f $PRISTINE/$f"
        return 0 
    else
        return 1
    fi
}

duplicates()
{
    f="$1"

    if [ -f $f ]
    then
        printf "\tMoving $f to DUPLICATES\n"
        echo "dry run: mv $f $DUPLICATES/$f"
    fi
}

empties()
{
    f="$1"

    if [ -s $f ]
    then
        printf "\tMoving $f to EMPTIES\n"
        echo "dry run: mv $f $EMPTIES/$f"
    fi
}

for h in /mnt/hd/thegvroot/hashes
do
    printf "\n==== Processing $h\n"
    for $f in $h
    do
        if [ -f "$f" ] &&  [[ ! $f = /filetank/repos/*  ]]
        then
            if [ -s "$f"  ]
            then
                pristine "$f" || duplicates "$f"  
            else   
                empties "$f"
            fi
        fi   
    done
done
